document.addEventListener('DOMContentLoaded', function () {
    const subjectInput = document.querySelector('.UserInput .Subject');
    const dropdown = document.querySelector('.UserInput .dropdown');
    const options = document.querySelectorAll('.UserInput .dropdown .option');
    const userImage = document.querySelector('.UserInput .usericon')
    const MoreInfo = document.querySelector('.GiveMoreInfo')
    const startButton = document.querySelector('.GetStartedButton');
    const giveInfo = document.querySelector('.a')
    const errormessage = document.querySelector('.UserInput .ErrorMessage')
    const subInfo = document.querySelector('.UserInput .SubInfo .SubInfoText')
    
    subjectInput.addEventListener('focus', () => {
        dropdown.style.display = 'block';
    });

    subjectInput.addEventListener('click', () => {
        dropdown.style.display = 'block';
    });
    if (window.innerWidth < 768 && subjectInput.value) { 
        document.querySelector('.Pooh img').style.top = '100%'
    }
    options.forEach(option => {
        option.addEventListener('click', () => {
            subjectInput.value = option.textContent;
            dropdown.style.display = 'none';
            if(subjectInput.value) {
               userImage.style.top  = '31%'
               document.querySelector('.Pooh img').style.top = '12%'
               document.querySelector('.UserInput .SubInfo .a213').style.display = 'block'
               document.querySelector('.a .pooh').style.top = '46%'
               giveInfo.style.display = 'block'
               subInfo.style.display = 'block'
               MoreInfo.innerHTML = `You chose ${option.textContent}. Can you specify the topic? For example, if it's History, which part (e.g., WW2)?`;
               subjectInput.style.border = ''
               errormessage.style.display = ''
               dropdown.style.top = '45%'
            }

        });
    });
    
    startButton.addEventListener('click', () => {
        if (!subjectInput.value) {
            subjectInput.style.border = '2px solid red';
            errormessage.style.display = 'block';
        } else if (subjectInput.value === 'History') {
            fetch('/History', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ subject: subjectInput.value }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.errors) {
                    data.errors.forEach(error => { 
                        if (error.error === 'ID_NOT_FOUND') {
                            subjectInput.style.border = '';
                            errormessage.style.display = 'none';
                            alert('id working');
                            document.querySelector('#GetStarted').style.display = 'none';
                        }
                    });
                } 
            })
            .catch(error => console.error('Error checking first time:', error));
        }
        
        /* else {
            subjectInput.style.border = ''
            errormessage.style.display = ''
            alert('Entered subject successfully')
            document.querySelector('#GetStarted').style.display = 'none'
        }*/
    });


    document.addEventListener('click', (event) => {
        if (!event.target.closest('.UserInput')) {
            dropdown.style.display = 'none';
        }
    });
    
});